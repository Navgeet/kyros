# Conversation Analysis Agent

A terminal-based agent that analyzes conversations from saved sessions and generates learnings from feedback patterns. This agent follows a feedback-improvement loop similar to `agent_v2.py` but operates in terminal mode for conversation analysis.

## Features

- **Conversation Loading**: Loads conversation data from saved JSON sessions
- **Feedback Pattern Analysis**: Automatically detects and analyzes feedback instances
- **LLM-Powered Analysis**: Uses InternLM API to generate comprehensive analysis
- **Interactive Improvement Loop**: Allows users to provide feedback to refine the analysis
- **Comprehensive Reporting**: Generates detailed reports with actionable insights
- **History Tracking**: Maintains a history of all improvement cycles

## Installation

The agent requires Python 3.7+ and the following packages:

```bash
pip install requests
```

## Configuration

Set your InternLM API credentials:

```bash
export INTERNLM_API_KEY="your-api-key-here"
export INTERNLM_API_URL="http://localhost:23333"  # Optional, defaults to localhost
```

## Usage

### Basic Usage

Analyze a specific conversation session:

```bash
python conversation_analysis_agent.py <session_id>
```

### List Available Sessions

See all available conversation sessions:

```bash
python conversation_analysis_agent.py --list
```

### Advanced Options

```bash
# Specify API configuration
python conversation_analysis_agent.py <session_id> --api-url http://localhost:23333 --api-key your-key

# Alternative session specification
python conversation_analysis_agent.py --session <session_id>
```

## Demo

To try the agent with sample data:

```bash
# Create sample conversation sessions
python demo_conversation_analysis.py

# Analyze the simple feedback example
python conversation_analysis_agent.py demo123

# Analyze the complex feedback loops example
python conversation_analysis_agent.py complex456
```

## Interactive Commands

Once the agent starts analyzing a session, you can use these commands:

- **`approve`/`accept`/`done`** - Accept the current analysis and save results
- **`save`** - Save current analysis without ending the session
- **`history`** - Show the improvement history
- **`help`** - Display all available commands
- **`quit`/`exit`/`q`** - Exit the analysis session

Or provide direct feedback to improve the analysis:
- *"Focus more on the technical aspects"*
- *"Add more specific examples"*
- *"Analyze the emotional tone of interactions"*

## Analysis Output

The agent generates comprehensive analysis covering:

1. **Feedback Quality Assessment**
   - Clarity and specificity of user feedback
   - Constructiveness and actionability
   - Communication patterns

2. **Agent Response Patterns**
   - How well the agent incorporated feedback
   - Areas where the agent struggled
   - Effectiveness of the improvement loop

3. **Conversation Flow Analysis**
   - Progression from initial request to final outcome
   - Points of friction or confusion
   - Successful collaboration moments

4. **Key Learnings and Insights**
   - What worked well in this interaction
   - What could be improved in future interactions
   - Patterns that could inform agent training

5. **Recommendations**
   - For improving agent responses
   - For guiding users to provide better feedback
   - For optimizing the feedback-improvement loop

## File Structure

- **Input**: Reads from `conversations/` directory (JSON files from agent_v2.py sessions)
- **Output**: Saves analysis results to `analysis_results/` directory
- **Format**: Results are saved as JSON files with full analysis history

## Example Session

```bash
$ python conversation_analysis_agent.py demo123

======================================================================
üî¨ CONVERSATION ANALYSIS AGENT
======================================================================
I analyze conversations and generate learnings from feedback patterns.
Type 'help' for commands, 'quit' to exit.
======================================================================

‚úÖ Loaded session: demo123
üìÖ Created: 2024-01-15T10:30:00
üë§ User request: Help me create a Python script to organize my files by date
üí¨ Messages: 7
üìù Has text plan: True
üêç Has code: True

==================================================
üîç GENERATING INITIAL ANALYSIS
==================================================

==================================================
üìä INITIAL ANALYSIS RESULTS
==================================================
[Detailed analysis generated by LLM...]

==================================================
üí¨ FEEDBACK & IMPROVEMENT LOOP
==================================================
Provide feedback on the analysis to improve it, or type commands:
‚Ä¢ 'approve' - Accept the current analysis
‚Ä¢ 'save' - Save analysis results to file
‚Ä¢ 'history' - Show improvement history
‚Ä¢ 'help' - Show all commands
‚Ä¢ 'quit' - Exit the program

[Cycle 0] üë§ Your feedback: Focus more on the technical implementation details

üîÑ Processing your feedback...

==================================================
üìä IMPROVED ANALYSIS (Cycle 1)
==================================================
[Improved analysis with more technical focus...]

[Cycle 1] üë§ Your feedback: approve

‚úÖ Analysis approved! Saving results...
üíæ Analysis saved to: analysis_results/analysis_demo123_20240115_143022.json
```

## Integration

This agent is designed to work with conversation sessions generated by:
- `agent_v2.py` - The main conversational planning agent
- Any system that saves conversations in the expected JSON format

## API Requirements

The agent uses the InternLM API for analysis generation. Ensure you have:
- Valid API key
- Access to the InternLM service
- Network connectivity to the API endpoint

## Troubleshooting

**No sessions found**: Ensure the `conversations/` directory exists and contains valid JSON session files.

**API errors**: Check your API key and URL configuration. The agent will warn if no API key is found.

**Import errors**: Install required packages with `pip install requests`.

## Contributing

This agent follows the same patterns as the existing codebase. When extending functionality:
- Follow the existing code style and structure
- Add appropriate error handling
- Update this README with new features
- Test with both simple and complex conversation scenarios